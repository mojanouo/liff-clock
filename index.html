<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LIFF 打卡 QR Code</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    h2 { color: #333; font-size: 28px; margin-bottom: 10px; }        /* 大字 */
    .time { font-size: 18px; font-weight: normal; margin-bottom: 5px; } /* 中字，不粗體 */
    .instruction { font-size: 18px; font-weight: normal; margin-bottom: 20px; } /* 中字，不粗體 */
    #status { white-space: pre-line; color: blue; }
    #qrcode { margin-top: 20px; }
  </style>
</head>
<body>
  <h2 id="name">載入中...</h2>
  <p id="time" class="time"></p>
  <p id="instruction" class="instruction"></p>
  <p id="status">初始化中...</p>
  <div id="qrcode"></div>

  <script>
    const liffId = "2008996338-0gw2Kj6n";

    async function main() {
      const nameEl = document.getElementById("name");
      const timeEl = document.getElementById("time");
      const instructionEl = document.getElementById("instruction");
      const statusEl = document.getElementById("status");
      const qrcodeEl = document.getElementById("qrcode");

      try {
        statusEl.innerText = "LIFF SDK 載入中...";
        await liff.init({ liffId });

        statusEl.innerText = "初始化成功，取得使用者資料...";
        const profile = await liff.getProfile();

        // 生成 QR Code 的資料
        const now = new Date();
        const timestamp = now.getTime(); // 毫秒
        const timeStr = now.toLocaleString();
        const qrData = profile.userId + "_" + timestamp;

        // 更新頁面文字
        nameEl.innerText = `你好 ${profile.displayName}`;
        timeEl.innerText = `現在時間是 ${timeStr}`;
        instructionEl.innerText = "請掃描下列 QR Code 進行打卡";

        // 產生 QR Code
        new QRCode(qrcodeEl, {
          text: qrData,
          width: 200,
          height: 200
        });

        statusEl.innerText = "QR Code 產生完成";

      } catch (err) {
        nameEl.innerText = "載入失敗";
        statusEl.innerText = "錯誤: " + (err.message || JSON.stringify(err));
        console.error(err);
      }
    }

    main();
  </script>
</body>
</html>
